{% extends "base/layout.html" %}
{% from 'base/components/forms.html' import field %}
{% from 'base/components/buttons.html' import submit %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1 fw-bold">Categorias de Despesas</h2>
        <p class="text-muted mb-0">Organize Grupos (ex: Moradia) e Itens (ex: Aluguel).</p>
    </div>
</div>

<div class="row g-4">
    
    {# Coluna de Grupos #}
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom-0 pt-4 pb-0">
                <h5 class="fw-bold mb-0"><i class="bi bi-folder-fill text-primary me-2"></i>Grupos de Despesa</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('financeiro.add_expense_group') }}">
                    {{ form_group.hidden_tag() }}
                    {# CORREÇÃO: Removido name='cat-name' #}
                    {{ field(form_group.name, placeholder="Ex: Moradia, Alimentação, Lazer") }}
                    <button type="submit" class="btn btn-primary w-100 mt-2">
                        Salvar Grupo
                    </button>
                </form>
                
                <h6 class="mt-4 mb-3 text-muted">Grupos Cadastrados ({{ groups|length }})</h6>
                <div class="list-group list-group-flush border-top">
                    {% for group in groups %}
                        <div class="list-group-item d-flex justify-content-between align-items-center py-2 px-0">
                            <span class="fw-medium">{{ group.name }} ({{ group.items.count() }} itens)</span>
                            <form method="POST" action="{{ url_for('financeiro.delete_expense_group', group_id=group.id) }}" onsubmit="return confirm('Tem certeza? A exclusão só é permitida se não houver itens ligados.');">
                                <button type="submit" class="btn btn-sm btn-link text-danger p-0" title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    {% else %}
                        <p class="text-muted small mt-2">Nenhum grupo cadastrado.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    {# Coluna de Itens #}
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom-0 pt-4 pb-0">
                <h5 class="fw-bold mb-0"><i class="bi bi-journal-text text-danger me-2"></i>Itens de Despesa</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('financeiro.add_expense_item') }}">
                    {{ form_item.hidden_tag() }}
                    {{ field(form_item.group) }}
                    {# CORREÇÃO: Removido name='item-name' #}
                    {{ field(form_item.name, placeholder="Ex: Aluguel, Supermercado, Assinatura Netflix") }}
                    <button type="submit" class="btn btn-danger w-100 mt-2">
                        Salvar Item
                    </button>
                </form>

                <h6 class="mt-4 mb-3 text-muted">Itens Cadastrados ({{ items|length }})</h6>
                <div class="list-group list-group-flush border-top">
                    {% for item in items %}
                        <div class="list-group-item d-flex justify-content-between align-items-center py-2 px-0">
                            <div>
                                <span class="fw-medium">{{ item.name }}</span>
                                <small class="d-block text-muted">({{ item.group.name }})</small>
                            </div>
                            <form method="POST" action="{{ url_for('financeiro.delete_expense_item', item_id=item.id) }}" onsubmit="return confirm('Tem certeza? A exclusão só é permitida se não houver despesas ligadas.');">
                                <button type="submit" class="btn btn-sm btn-link text-danger p-0" title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    {% else %}
                        <p class="text-muted small mt-2">Nenhum item cadastrado.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% macro field(field) %}
    <div class="mb-3">
        {{ field.label(class="form-label fw-bold small text-muted") }}
        
        {% set icon = kwargs.pop('icon', none) %}
        {% set field_class = kwargs.pop('class', '') %}
        
        <div class="input-group">
            {% if icon %}
                <span class="input-group-text bg-light border-end-0">
                    <i class="{{ icon }}"></i>
                </span>
            {% endif %}

            {% if field.type == 'SelectField' %}
                {% set field_class = field_class or 'form-select' %}
                {{ field(class=field_class + ( ' border-start-0' if icon else ''), **kwargs) }}
            
            {% elif field.type == 'TextAreaField' %}
                {% set field_class = field_class or 'form-control' %}
                {% set rows = kwargs.pop('rows', (field.render_kw or {}).get('rows', 3)) %}
                {{ field(class=field_class + ( ' border-start-0' if icon else ''), rows=rows, **kwargs) }}
            
            {% elif field.type == 'DateField' %}
                {% set field_class = field_class or 'form-control' %}
                {{ field(class=field_class + ( ' border-start-0' if icon else ''), type="date", **kwargs) }}
            
            {% else %}
                {% set field_class = field_class or 'form-control' %}
                {{ field(class=field_class + ( ' border-start-0' if icon else ''), **kwargs) }}
            {% endif %}
        </div>
        
        {% if field.errors %}
            {% for error in field.errors %}
                <div class="invalid-feedback d-block mt-1">{{ error }}</div>
            {% endfor %}
        {% endif %}
    </div>
{% endmacro %}
